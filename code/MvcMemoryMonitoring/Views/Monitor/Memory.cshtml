@{
    ViewBag.Title = "Memory Information";
}

<h2>PerfCounters</h2>

@using System.Diagnostics;
<!DOCTYPE html>
<html>
<head>
    <title>ASP.NET MVC Memory Monitoring</title>
</head>
<body>
    <div id="wrapper">
        <div class="content">
            <header>
                <h1>ASP.NET MVC Memory Monitoring - @ViewBag.Title</h1>
                <p>
                    This page shows you the resource memory consumption by your application as exposed through the AppDomain. 
                    It also shows the current values of several performance counters related to memory usage and ASP.NET Caching stats.
                </p>
            </header>
            <div>
                <section id="content">
                    <article>
                        <h2>Memory and CPU Consumption</h2>
                        <p class="container">
                            <ul>
                                <li><b>Total Bytes Allocated:</b> @AppDomain.CurrentDomain.MonitoringTotalAllocatedMemorySize Bytes</li>
                                <li><b>Total MB Allocated:</b> @(AppDomain.CurrentDomain.MonitoringTotalAllocatedMemorySize / 1024 / 1024) MB</li>
                                <li><b>Total Bytes In Use:</b> @AppDomain.CurrentDomain.MonitoringSurvivedMemorySize Bytes</li>
                                <li><b>Total MB In Use:</b> @(AppDomain.CurrentDomain.MonitoringSurvivedMemorySize / 1024 / 1024) MB</li>
                                <li><b>CPU usage:</b> @AppDomain.CurrentDomain.MonitoringTotalProcessorTime.Milliseconds Milliseconds</li>
                                <li><b>CPU usage:</b> @(AppDomain.CurrentDomain.MonitoringTotalProcessorTime.Milliseconds / 1000) Seconds</li>
                            </ul>
                        </p>
                    </article>
                    <article>
                        <h2>@ViewBag.Title</h2>
                        <ul>
                            @{ PerformanceCounterCategory[] perfCats = PerformanceCounterCategory.GetCategories(); }
                            @foreach (PerformanceCounterCategory category in perfCats.OrderBy(c => c.CategoryName))
                            {
                                <li>Category Name: @category.CategoryName
                                    <ul>
                                        @{
                                //Get all instances available for category
                                string[] instances = category.GetInstanceNames();
                                if (instances.Length == 0)
                                {
                                    //This block will execute when category has no instance.
                                    //loop all the counters available withing category
                                    foreach (PerformanceCounter counter in category.GetCounters())
                                    {
                                            <li>Counter Name: @counter.CounterName</li>
                                    }
                                }
                                else
                                {
                                            <li>Instances: 
                                            <ul>
                                                @{//This block will execute when category has one or more instances.
                                    foreach (string instance in instances)
                                    {
                                                    <li>Instance Name: @instance;</li>                                                
                                    }                                            
                                                }
                                            </ul>
                                            </li>
                                    //loop all the counters available withing category
                                    foreach (PerformanceCounter counter in category.GetCounters(instances[0]))
                                    {
                                            <li>Counter Name: @counter.CounterName</li>
                                    }
                                }
                                        }
                                    </ul>
                                </li>
                            }
                        </ul>

                    </article>
                </section>
            </div>
        </div>
        <footer>
        </footer>
    </div>
</body>
</html>

